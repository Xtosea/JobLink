import React, { useEffect, useState, useContext } from "react";
import { AuthContext } from "../../context/AuthContext";
import axios from "axios";

export default function History() {
  const { token } = useContext(AuthContext);
  const [apps, setApps] = useState([]);

  useEffect(() => {
    if (!token) return;
    axios.get(`${process.env.REACT_APP_API_BASE}/api/applications/me`, {
      headers: { Authorization: `Bearer ${token}` },
    })
    .then(res => setApps(res.data))
    .catch(console.error);
  }, [token]);

  return (
    <div className="max-w-4xl mx-auto p-4">
      <h2 className="text-xl font-bold mb-4">Your Applications</h2>
      {apps.map(app => (
        <div key={app._id} className="p-3 bg-white rounded shadow mb-3">
          <div><strong>{app.fullname}</strong> - {app.jobPosition} ({app.jobType})</div>
          <div>Status: {app.status}</div>
          <div>Reply: {app.reply || "No reply yet"}</div>
          {app.proofFile && <a href={app.proofFile} target="_blank" rel="noreferrer">View Proof</a>}
          {app.resumeFile && <a href={app.resumeFile} target="_blank" rel="noreferrer">View CV</a>}
        </div>
      ))}
    </div>
  );
}